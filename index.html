<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>title</title>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
		integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<!-- Leaflet CSS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin="" />
	<!-- Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Catamaran:600|Merriweather+Sans:300" rel="stylesheet">
	
	<style>
		body {
			background: #20282e;
			font-family: 'Merriweather Sans', Sans-Serif;
		}

		header {
			background-image: linear-gradient(to left,#0033A0,#1B365D)
		}

		h1 {
			Font-Family: 'Catamaran', Sans-Serif;
			font-weight: 800;
		}

		h3 {
			Font-Family: 'Catamaran', Sans-Serif;
			font-style: oblique;
		}

		p {
			Font-Family: 'Merriweather Sans', Sans-Serif;
			line-height: 1.4rem;
			font-size: .8em;
		}
		
		h2 {
			Font-Family: 'Merriweather Sans', Sans-Serif;
			font-size: .6em;
			font-style: italic 
		}

		a {
			color: #FFDC00;
		}

		a:hover {
			color: #FFA360;
		}

		footer {
			Font-Family: 'Merriweather Sans', Sans-Serif;
			line-height: 1.4rem;
			background-image: linear-gradient(to left,#0033A0,#1B365D)
		}

		label {
			font-size: 1.1em;
		}

		li {
			font-size: .8em;
			text-align: right;
		}	
		#about {
			background-color: #f8f8f4;
		}

		#map {
			height: 80vh;
			background: #20282e;
		}

		#legend {
			font-size: 1rem;
			border-radius: 5px;
			max-width: 200px;
			font-family: 'Open Sans', sans-serif;
		}

		#legend span {
			width: 20px;
			height: 20px;
			float: left;
			margin: 0 10px 4px 0;
		}

		#legend label {
			font-size: 0.9rem;
		}

		#legend label:after {
			content: '';
			display: block;
			clear: both;
		}

		#ui-menu {
			position: absolute;
			z-index: 10000;
			right: 1em;
			top: 1em;
		}

		#ui-controls {
			width: 176px;
			padding: 8px 25px 8px 15px;
			background: rgba(75, 75, 75, 0.8);
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			border-radius: 5px;
			color: whitesmoke;
		}

		#year {
			width: 135px;
			padding: 8px 8px 8px 8px;
			background:#1B365D;
			opacity: .75;
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			border-radius: 5px;
			color: whitesmoke;
		}

		#ui-controls .min {
			float: left;
		}

		#ui-controls .max {
			float: right;
			margin-right: -15px;
		}

		.year-slider {
			width: 100%;
		}

.leaflet-tooltip-left:before {
    right: 0;
    margin-right: -12px;
    border-left-color: rgba(0, 0, 0, 0.4);
}

.leaflet-tooltip-right:before {
    left: 0;
    margin-left: -12px;
    border-right-color: rgba(0, 0, 0, 0.4);
    }

.leaflet-tooltip-own {
    position: absolute;
    padding: 5px;
	background-color: rgba(0, 0, 0, 0.4);
    border: 0px solid #000;
    color: #000;
	white-space: nowrap;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    pointer-events: none;
    box-shadow: 0 1px 3px rgba(0,0,0,0.4);
}

.leaflet-tooltip img {
	max-width: 200px;
	max-height: 200px;
	border-radius: 10%;
}


		/* Small devices (landscape phones, 576px and up) */
		@media (min-width: 576px) {}

		/* Medium devices (tablets, 768px and up) */
		@media (min-width: 768px) {

			aside {
				height: 80vh;
			}
		}

		/* Large devices (desktops, 992px and up) */
		@media (min-width: 992px) {}

		/* Extra large devices (large desktops, 1200px and up) */
		@media (min-width: 1200px) {}
	</style>

</head>

<body>
	<div class="container-fluid">
		<header class="row text-white py-3">
			<div class="col">
				<h1>Campus Expansion through the Decades</h1>
			</div>
		</header>

		<section class="row">
			<div class="col-md-9 col-lg-9 col-xl-9 order-md-2 px-0">
				<div id='map'>
				<div id="ui-menu" class="dropdown">
					<a class="btn btn-light text-secondary font-weight-bold dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
						data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						All Building Types
					</a>
					<div class="dropdown-menu" aria-labelledby="dropdownMenuLink"></div>
				</div>
				<div id="ui-controls" class="bg-light text-secondary font-weight-bold">
					<label><span class="min">1865</span><span class="max">2020</span>
					<input type="range" min="1865", max="2020",
						value="2020", step="10" class="year-slider" ></input>
					</label>  
				</div>
				<!-- ui construction year date -->
				<div id='year' class="text-light font-weight-bold">
					<label><img src="graphics/dashed-line.png" width="20px" height="20px"> UK Property</br>
					</br>
						Year Display: <span>2020</span></label>
				</div>
				</div>
			</div>
			<aside id="about"
				class="col-md-3 col-lg-3 col-xl-3 order-md-1 text-dark py-2 pl-3 overflow-auto">
				<section>
					<h3 class="py-2">University of Kentucky Building History (1865-2020)</h3>
					<p>Travel back through time and get a glimpse of the University of Kentucky (UK) campus. 
						Use this map to	explore building construction, acquisition, and historical 
						trends in usage and campus planning. This map lays out the building history 
						on UK Campus as it exists today, with only existing structures (buildings that
						have been demolished are not shown). 
					<p>UK was first established as a land-grant	institution in 1865. It wasn't until 1880 
						that UK started development at its current location off of South Limestone in 
						Lexington, Kentucky. The campus initially comprised of three buildings, only one 
						of which still remains - UK Main Building (1882).</br>
					<p></p>
					<a href="https://exploreuk.uky.edu/fa/findingaid/?id=xt7f4q7qpg4w">
						<img src="https://exploreuk.uky.edu/dips/xt7f4q7qpg4w/data/2001ua068/2001ua068_1/2001ua068_1_13_p/2001ua068_01_013/2001ua068_01_013.jpg" 
						alt="Main Administration Building" class="col-md-12 "></a>
					<h2 class="col-md-12 ">Photo of Main Administration Building. Provided by exploreUK, 
						clicking the image will take you to a collection of UK postcards. </h2>
					<p>After scrolling through the time slider you will notice there are several buildings 
						that were constructed in earlier years, and later acquired by the University as campus 
						expanded. The oldest structure on campus is actually 206 E Maxwell St. - built in 1853
						and acquired by the University in 1994. By selecting from the dropdown options, you can
						also filter and examine key trends based on buildings usage type (housing, medical, 
						campus, etc.).</br>
					</p>
				</section>
			</aside>
		</section>

		<footer class="row text-white py-3">
			<div class="col">
				<ul class="list-unstyled">
					<h2 align="right">This product is not affiliated or sponsored by the University of Kentucky</h2>
					<li>Authored by <a href="https://jmfr236.github.io/">Jessica Freeman</a>, December 2020</li>
					<li>Building Data Source: University of Kentucky <a href="https://www.uky.edu/gissupport/data">ITS Information Services Department</a></li>
					<li>Historic Reference Source: University of Kentucky <a href="https://www.uky.edu/uk150/history">History - UK150</a></li>
				</ul>
			</div>
		</footer>
	</div>

	<!-- jQuery first and the minified version from jQuery site, not the slim minified version from Bootstrap's site. -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<!-- then Popper JS -->
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
		integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
		crossorigin="anonymous"></script>
	<!-- then Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
		integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
		crossorigin="anonymous"></script>
	<!-- then Leaflet JS -->
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>
	<!-- then jQuery slider -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
	
	// map options, centered on Lexington, KY
	const options = {
		zoomSnap: .1,
		center: [38.027, -84.504],
		zoom: 14.5,
		minZoom: 12,
		maxZoom: 18,
		maxBounds: L.latLngBounds([38.066, -84.547], [37.996, -84.454])
	};

	// create the Leaflet map
	const map = L.map('map', options);

	// mapbox API access Token
	// mapbox API parameters
	const accessToken = `pk.eyJ1Ijoiam1mcjIzNiIsImEiOiJja2g3dnM0MHAwZDJrMnBrMTFzMWdoODFwIn0.zy_4IRy1IBZR3ojoFOsiFA`
	const yourName = 'jmfr236'
	const yourMap = 'ckidrdhek2d6w19m4sf5kvqlx'

  	// request a mapbox raster tile layer and add to map
	L.tileLayer(`https://api.mapbox.com/styles/v1/${yourName}/${yourMap}/tiles/256/{z}/{x}/{y}?access_token=${accessToken}`, {
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		maxZoom: 18
	}).addTo(map);
		
	// move zoom control to the bottom right
	//new L.control.zoom({position:"bottomright"}).addTo(map)

	//add 2020 UK property boundary layer
	const property = $.getJSON("data/uk_property.geojson", function (data) {
		const propLayer = L.geoJson(data, {
			style: function (feature) {
				return {
					color: 'black',
					weight: 1,
					dashArray: '2',
					fillColor: 'none',
				};
			},
		}).addTo(map);
	});

	// add UK buildings layer
	$.getJSON("data/uk_buildings.geojson", function (buildings) {
		console.log(buildings);
		/* const dataLayer = L.geoJson(buildings, {
			style: function (feature) {
				return {
				color: '#20282e',
				weight: 1,
				fillOpacity: .75,
				fillColor: "#1f78b4",
				};
			},
		}); 
		// var zoomExtent = dataLayer.getBounds();
		dataLayer.addTo(map);*/
		drawMap(buildings); 
	});
	

	function drawMap(buildings) {
		console.log(buildings);
		const dataLayer = L.geoJson(buildings, {
			style: function (feature) {
				return {
				color: '#20282e',
				weight: 1,
				fillOpacity: .75,
				fillColor: "#1f78b4",
				};
			},
		}).addTo(map); 
		// var zoomExtent = dataLayer.getBounds();

		//create the slider
		// filterByAttribute(dataLayer, buildings);
		createSliderUI(dataLayer);
		console.log(dataLayer);
      	// call the initially color the map with first timestamp
		updateMap(dataLayer,'2020');
    }

    function updateMap(dataLayer, currentYear) {
    	// loop through each county layer to update the color 
		dataLayer.eachLayer(function (layer) {

        const props = layer.feature.properties;

        /*// build the tooltip 
		const tooltip = `<p align="center"><label><b><u>${props['GIS_MAPB_2']}  (#${props['BuildingID']})</u></b><br/>
		${props['GIS_MAPB_4']}, Lexington, KY ${props['GIS_MAPB_5']}<br/>
		<b>Maintenance Area:</b> ${props['GIS_MAPB_9']}<br/>
		<b>Constructed:</b> ${props['UK_Build_3']}<br/>
		<b>Acquired:</b> ${props['UK_Build_4']}<br/></p>
		<img class="col-md-12" src="https://maps.uky.edu/campusmap/bldg/${props['BuildingID']}.jpg"</label></p>`
		// Set up formula to if only show acquired if constructed and acquired are not the same

        //bind the tooltup to the layer
        layer.bindTooltip(tooltip, {
			sticky: true
		}); */

		layer.bindTooltip("<div style='background:white; padding: 10px 5px 5px 5px'>" + 
			`<p align="center"><label><b><u>${props['GIS_MAPB_2']}  (#${props['BuildingID']})</u></b><br/>
				${props['GIS_MAPB_4']}, Lexington, KY ${props['GIS_MAPB_5']}<br/>
				<b>Maintenance Area:</b> ${props['GIS_MAPB_9']}<br/>
				<b>Constructed:</b> ${props['UK_Build_3']}<br/>
				<b>Acquired:</b> ${props['UK_Build_4']}</br>
				<img class="col-md-12" src="https://maps.uky.edu/campusmap/bldg/${props['BuildingID']}.jpg"></label></p>` + "</div>",
		{
			direction: 'right',
			permanent: false,
			sticky: true,
			offset: [10, 0],
			align: 'center',
			opacity: 1,
			className: 'leaflet-tooltip-own' 
		});

		layer.on("mouseover", function () {
                    layer.bringToFront();
                    layer.setStyle({
                        color: "yellow",
                        weight: 2,
                    });
                });

                layer.on("mouseout", function () {
                    layer.bringToBack();
                    layer.setStyle({
						color: '#20282e',
						weight: 1,
						fillOpacity: .75,
						fillColor: "#1f78b4",
                    });
                });
		});
	};
 // end updateMap()

	function createSliderUI(dataLayer) {
      // create Leaflet control for the slider
		const sliderControl = L.control({ 
			position: 'bottomleft'
		});

      // when added to the map
		sliderControl.onAdd = function(map) {

			// select an existing DOM element with an id of "ui-controls"
			const slider = L.DomUtil.get("ui-controls");

			// disable scrolling of map while using controls
			L.DomEvent.disableScrollPropagation(slider);

			// disable click events while using controls
			L.DomEvent.disableClickPropagation(slider);

			// return the slider from the onAdd method
			return slider;
		}

    	// add the control to the map
		sliderControl.addTo(map);

		// add legend and year display showing the year selected
		var yearControl = L.control({
			position: 'bottomleft'
		});

		yearControl.onAdd = function (map) {

			var controls = L.DomUtil.get("year");

			L.DomEvent.disableScrollPropagation(controls);
			L.DomEvent.disableClickPropagation(controls);

			return controls;

		}

		yearControl.addTo(map);

      // select the form element
		$(".year-slider")
        	.on("input change", function() { // when user changes
				const currentYear = $(this).val(); // update the year
				$('.legend h3 span').html(currentYear); // update the map with current timestamp
				updateMap(dataLayer, currentYear); // update timestamp in legend heading
        	});
	} 
	// end createSliderUI() */
	
	/* function filterByAttribute(dataLayer, buildings) {
	// array to hold select options
	var uniqueTypes = [];

	// loop through all features and push unique types to array
	dataLayer.forEach(function (maint) {
	if (!uniqueTypes.includes(maint.GIS_MAPB_9)) {
		uniqueTypes.push(maint.GIS_MAPB_9);
	}
	});

	// sort strings alphabetically
	uniqueTypes.sort();

	// add an all facilities to the beginning
	uniqueTypes.unshift('All Facilities');

	// select all the options (that don't exist yet)
	d3.select('#ui .dropdown-menu').selectAll('a')
	.data(uniqueTypes) // use array as data
	.join('a') // append a new option element for each data item
	.text(d => {
		return d // use the item as text
	})
	.attr('value', d => {
		return d // use the time as value attribute
	})
	.attr('href', '#')
	.classed('dropdown-item', true)
	.on('click', onchange);  // when the user clicks call onchange function

	function onchange() {
	// get the currently selected value
	let val = d3.select(this).attr('value');
	
	// change the display property for each circle
	facilities.style('display', d => {
	if (val === 'All Facilities') return 'inline';
	if (d.GIS_MAPB_9 != val) return 'none';
	});
	d3.select('#ui > a').html(val);  // update the UI with current val
	}} */
/*
		const buildingLayer = $.getJSON("data/UK_Building_Facility.json", function (data) {
			// jQuery method uses AJAX request for the GeoJSON data
			
			const buildingLayer = L.geoJson(data, {
  				// style counties with initial default path options
			style: function (feature) {
					return {
						color: '#20282e',
						weight: 2,
						fillOpacity: 1,
						fillColor: '#1f78b4'
					};
				},
  				// add hover/touch functionality to each feature layer
				onEachFeature: function (feature, layer) {

    				// when mousing over a layer
					layer.on('mouseover', function () {

      					// change the stroke color and bring that element to the front
						layer.setStyle({
							color: '#ff6e00'
						}).bringToFront();
					});

    				// on mousing off layer
					layer.on('mouseout', function () {

      					// reset the layer style to its original stroke color
						layer.setStyle({
							color: '#20282e'
						});
					});
				},
			}).addTo(map);

			// call addUi function
			addUi(buildings); // add the UI controls

			// call updateMap function
			updateMap(buildings); // draw the map*/

			// call draw map function and send data as parameter
			//drawMap(data);
		//});
		/*
		function drawMap(data) {
			console.log(data); // data os now accessible here
		}
	

		/*function updateMap(counties) {
  			// you could log counties to console here to 
  			// verify the Leaflet layers object is not accessible
  			// and scoped within this function
			console.log(counties);
			// get the class breaks for the current data attribute
			const breaks = getClassBreaks(counties);

			// loop through each county layer to update the color and tooltip info
			counties.eachLayer(function (layer) {

				const props = layer.feature.properties;

				// set the fill color of layer based on its normalized data value
				layer.setStyle({
					fillColor: getColor(props[attributeValue] /
						props[normValue], breaks)
				});

				// assemble string sequence of info for tooltip (end line break with + operator)
				let tooltipInfo = `<b>${props["NAME"]} County</b></br>
					${((props[attributeValue] / props[normValue]) * 100).toLocaleString()}%`

  				// bind a tooltip to layer with county-specific information
				layer.bindTooltip(tooltipInfo, {
					// sticky property so tooltip follows the mouse
				sticky: true
				});
			});

			// add legend to map
			addLegend(breaks)
			// update the legend with the current data attribute information
			updateLegend(breaks);
		}

		//Get class breaks in data
		function getClassBreaks(counties) {

  			// create empty Array for storing values
			const values = [];

			// loop through all the counties
			counties.eachLayer(function (layer) {
				let value = layer.feature.properties[attributeValue] / layer.feature.properties[normValue];
  				values.push(value); // push the normalized value for each layer into the Array
			});

			// determine similar clusters
			const clusters = ss.ckmeans(values, 5);

			// create an array of the lowest value within each cluster
			const breaks = clusters.map(function (cluster) {
				return [cluster[0], cluster.pop()];
			});

			//return array of arrays, e.g., [[0.24,0.25], [0.26, 0.37], etc]
			return breaks;
		}

		// Get color of county
		function getColor(d, breaks) {
			// function accepts a single normalized data attribute value
			// and uses a series of conditional statements to determine which
			// which color value to return to return to the function caller

			if (d <= breaks[0][1]) {
				return '#f1eef6';
			} else if (d <= breaks[1][1]) {
				return '#bdc9e1';
			} else if (d <= breaks[2][1]) {
				return '#74a9cf';
			} else if (d <= breaks[3][1]) {
				return '#2b8cbe'
			} else if (d <= breaks[4][1]) {
				return '#045a8d'
			}
		}

		function addLegend(breaks) {
  			// create a new Leaflet control object, and position it top left
			const legendControl = L.control({ position: 'topleft' });

  			// when the legend is added to the map
			legendControl.onAdd = function() {

				// select a div element with an id attribute of legend
				const legend = L.DomUtil.get('legend');

				// disable scroll and click/touch on map when on legend
				L.DomEvent.disableScrollPropagation(legend);
				L.DomEvent.disableClickPropagation(legend);

				// return the selection to the method
				return legend;
			};

			// add the empty legend div to the map
			legendControl.addTo(map);
		}

		function updateLegend(breaks) {

			// select the legend, add a title, begin an unordered list and assign to a variable
			const legend = $('#legend').html(`<h5>${labels[attributeValue]}</h5>`);

			// loop through the Array of classification break values
			for (let i = 0; i <= breaks.length - 1; i++) {

				let color = getColor(breaks[i][0], breaks);

				legend.append(
					`<span style="background:${color}"></span>
					<label>${(breaks[i][0] * 100).toFixed(1)} &mdash;
					${(breaks[i][1] * 100).toFixed(1)}%</label><br>`);
			}
		}

		function addUi(counties) {
			console.log(counties)
			// create the slider control
			var selectControl = L.control({ position: "topright" });
			
			// when control is added
			selectControl.onAdd = function() {
				// get the element with id attribute of ui-controls
				return L.DomUtil.get("dropdown-ui");
			};
			
			// add the control to the map
			selectControl.addTo(map);
			$('#dropdown-ui select').change(function() {
			// code executed here when change event occurs
			//console.log(this.value);
			//Update attributeValue to value user has selected
			attributeValue = this.value;

			//call updateMap function
			updateMap(counties);

			});
		}
*/
	</script>
</body>

</html>